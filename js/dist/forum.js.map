{"version":3,"sources":["webpack://@the-turk/flarum-mathren/webpack/bootstrap","webpack://@the-turk/flarum-mathren/./forum.js","webpack://@the-turk/flarum-mathren/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@the-turk/flarum-mathren/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@the-turk/flarum-mathren/./src/forum/addCopyListener.js","webpack://@the-turk/flarum-mathren/./src/forum/addPostQuoteButton.js","webpack://@the-turk/flarum-mathren/./src/forum/addTextEditorButton.js","webpack://@the-turk/flarum-mathren/./src/forum/components/TextEditorButton.js","webpack://@the-turk/flarum-mathren/./src/forum/fragments/PostQuoteButton.js","webpack://@the-turk/flarum-mathren/./src/forum/index.js","webpack://@the-turk/flarum-mathren/./src/forum/utils/cleanDisplayName.js","webpack://@the-turk/flarum-mathren/./src/forum/utils/copyDelimiters.js","webpack://@the-turk/flarum-mathren/./src/forum/utils/katex2tex.js","webpack://@the-turk/flarum-mathren/./src/forum/utils/reply.js","webpack://@the-turk/flarum-mathren/./src/forum/utils/selectedText.js","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['Fragment']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/Component']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/app']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/components/Button']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/components/Dropdown']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/extend']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/helpers/icon']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['common/utils/ItemList']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['components/CommentPost']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['components/DiscussionPage']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['components/EditPostComposer']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['components/TextEditor']\"","webpack://@the-turk/flarum-mathren/external \"flarum.core.compat['utils/DiscussionControls']\""],"names":["_inheritsLoose","subClass","superClass","prototype","Object","create","constructor","setPrototypeOf","_setPrototypeOf","o","p","__proto__","addCopyListener","extend","DiscussionPage","app","forum","attribute","delimiters","inline","block","document","addEventListener","event","selection","window","getSelection","isCollapsed","fragment","getRangeAt","cloneContents","querySelector","html","i","childNodes","length","push","outerHTML","clipboardData","setData","join","katexReplaceWithTex","copyDelimiters","textContent","preventDefault","addPostQuoteButton","CommentPost","post","attrs","isHidden","session","user","discussion","canReply","$postBody","$","$container","button","PostQuoteButton","handler","e","setTimeout","content","selectedText","m","render","rects","getClientRects","firstRect","clientY","bottom","clientX","right","left","showStart","top","lastRect","showEnd","after","on","addTextEditorButton","TextEditor","items","add","composer","editor","localePrefix","oninit","vnode","oncreate","view","Dropdown","component","className","buttonClassName","label","icon","toArray","ItemList","Button","onclick","leftDelim","rightDelim","wrapSelection","translator","trans","selectionRange","textEditor","getSelectionRange","insertAt","replaceBeforeCursor","moveCursorTo","Component","reply","show","$this","parentOffset","offsetParent","offset","css","hideHandler","hide","bind","scrollTop","outerHeight","outerWidth","off","Fragment","initializers","whenLoaded","hasLoaded","isLoading","load","getScript","id","renderMath","element","renderMathInElement","s9e","TextFormatter","original","preview","matches","cleanDisplayName","displayName","replace","display","katexHtml","querySelectorAll","remove","parentNode","removeChild","katexMathml","texSource","replaceWith","replaceChild","innerHTML","displays","substr","insertMention","quote","mention","fields","body","originalContent","cursorPosition","preceding","slice","precedingNewlines","match","insertAtCursor","Array","trim","bodyMatches","EditPostComposer","DiscussionControls","replyAction","call","then","rangeCount","range","parent","commonAncestorContainer","contains","clone","append","find","alt","src","innerText","href","text"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","/**\n * Copied & modified from:\n * https://github.com/KaTeX/KaTeX/blob/master/contrib/copy-tex/copy-tex.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2013-2020 Khan Academy and other contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { extend } from 'flarum/common/extend';\nimport DiscussionPage from 'flarum/components/DiscussionPage';\nimport katexReplaceWithTex from './utils/katex2tex';\nimport copyDelimiters from './utils/copyDelimiters';\n\nexport default function addCopyListener() {\n  extend(DiscussionPage.prototype, 'oncreate', function () {\n    if (!app.forum.attribute('mathRenEnableCopyTeX')) return;\n\n    const delimiters = {\n      inline: app.forum.attribute('mathRenMainInlineDelimiter'),\n      block: app.forum.attribute('mathRenMainBlockDelimiter'),\n    };\n\n    // Global copy handler to modify behavior on .katex elements.\n    document.addEventListener('copy', function (event) {\n      const selection = window.getSelection();\n      if (selection.isCollapsed) {\n        return; // default action OK if selection is empty\n      }\n      const fragment = selection.getRangeAt(0).cloneContents();\n      if (!fragment.querySelector('.katex-mathml')) {\n        return; // default action OK if no .katex-mathml elements\n      }\n      // Preserve usual HTML copy/paste behavior.\n      const html = [];\n      for (let i = 0; i < fragment.childNodes.length; i++) {\n        html.push(fragment.childNodes[i].outerHTML);\n      }\n      event.clipboardData.setData('text/html', html.join(''));\n      // Rewrite plain-text version.\n      event.clipboardData.setData('text/plain', katexReplaceWithTex(fragment, copyDelimiters(delimiters)).textContent);\n      // Prevent normal copy handling.\n      event.preventDefault();\n    });\n  });\n}\n","/**\n * Copied & modified from:\n * https://github.com/flarum/mentions/blob/master/js/src/forum/addPostQuoteButton.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 Stichting Flarum (Flarum Foundation)\n * Copyright (c) 2014-2019 Toby Zerner (toby.zerner@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport { extend } from 'flarum/common/extend';\nimport CommentPost from 'flarum/components/CommentPost';\nimport PostQuoteButton from './fragments/PostQuoteButton';\nimport selectedText from './utils/selectedText';\nimport copyDelimiters from './utils/copyDelimiters';\n\nexport default function addPostQuoteButton() {\n  extend(CommentPost.prototype, 'oncreate', function () {\n    if (!app.forum.attribute('mathRenAddQuoteButton') || !app.forum.attribute('mathRenEnableCopyTeX')) return;\n\n    const post = this.attrs.post;\n    const delimiters = {\n      inline: app.forum.attribute('mathRenMainInlineDelimiter'),\n      block: app.forum.attribute('mathRenMainBlockDelimiter'),\n    };\n\n    if (post.isHidden() || (app.session.user && !post.discussion().canReply())) return;\n\n    const $postBody = this.$('.Post-body');\n\n    // Wrap the quote button in a wrapper element so that we can render\n    // button into it.\n    const $container = $('<div class=\"Post-quoteButtonContainer-mathRen\"></div>');\n\n    const button = new PostQuoteButton(post);\n\n    const handler = function (e) {\n      setTimeout(() => {\n        const content = selectedText($postBody, copyDelimiters(delimiters));\n        if (content) {\n          button.content = content;\n          m.render($container[0], button.render());\n\n          const rects = window.getSelection().getRangeAt(0).getClientRects();\n          const firstRect = rects[0];\n\n          if (e.clientY < firstRect.bottom && e.clientX - firstRect.right < firstRect.left - e.clientX) {\n            button.showStart(firstRect.left, firstRect.top);\n          } else {\n            const lastRect = rects[rects.length - 1];\n            button.showEnd(lastRect.right, lastRect.bottom);\n          }\n        }\n      }, 1);\n    };\n\n    this.$().after($container).on('mouseup', handler);\n\n    if ('ontouchstart' in window) {\n      document.addEventListener('selectionchange', handler, false);\n    }\n  });\n}\n","import { extend } from 'flarum/common/extend';\nimport TextEditor from 'flarum/components/TextEditor';\nimport TextEditorButton from './components/TextEditorButton';\n\nexport default function addTextEditorButton() {\n  extend(TextEditor.prototype, 'toolbarItems', function (items) {\n    if (app.forum.attribute('mathRenEnableTextEditorButtons') === true) {\n      items.add('the-turk-mathren', <TextEditorButton textEditor={this.attrs.composer.editor} />);\n    }\n  });\n}","import app from 'flarum/common/app';\nimport Component from 'flarum/common/Component';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport Button from 'flarum/common/components/Button';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport icon from 'flarum/common/helpers/icon';\n\nconst localePrefix = 'the-turk-mathren.forum.textEditor.';\n\nexport default class extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n    \n    this.delimiters = {\n      inline: app.forum.attribute('mathRenMainInlineDelimiter'),\n      block: app.forum.attribute('mathRenMainBlockDelimiter'),\n    };\n  }\n\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n\n  view() {\n    return Dropdown.component(\n      {\n        className: 'MathRenDropdown',\n        buttonClassName: 'Button Button--flat',\n        label: icon('fas fa-square-root-alt'),\n      },\n      this.items().toArray()\n    );\n  }\n\n  /**\n   * Build an item list for the contents of the dropdown menu.\n   *\n   * @return {ItemList}\n   */\n  items() {\n    const items = new ItemList();\n\n    items.add(\n      'mathBlock',\n      Button.component(\n        {\n          icon: 'fas fa-vector-square',\n          onclick: () => {\n            // opening tag (left delimiter)\n            const leftDelim = this.delimiters.block['left'];\n            // closing tag (right delimiter)\n            const rightDelim = this.delimiters.block['right'];\n\n            this.wrapSelection(leftDelim, rightDelim);\n          },\n        },\n        app.translator.trans(localePrefix + 'blockExpression')\n      ),\n      50\n    );\n\n    items.add(\n      'mathInline',\n      Button.component(\n        {\n          icon: 'fas fa-grip-lines',\n          onclick: () => {\n            // opening tag (left delimiter)\n            const leftDelim = this.delimiters.inline['left'];\n            // closing tag (right delimiter)\n            const rightDelim = this.delimiters.inline['right'];\n\n            this.wrapSelection(leftDelim, rightDelim);\n          },\n        },\n        app.translator.trans(localePrefix + 'inlineExpression')\n      ),\n      0\n    );\n\n    return items;\n  }\n\n  /**\n   * Wrap the current selection with BBCode tags\n   * If there's no selection, put them around the cursor\n   * \n   * @param string leftDelim\n   * @param string rightDelim\n   */\n  wrapSelection(leftDelim, rightDelim) {\n    const selectionRange = this.attrs.textEditor.getSelectionRange();\n\n    if(selectionRange[0] != selectionRange[1]) {\n      this.attrs.textEditor.insertAt(selectionRange[0], leftDelim);\n      this.attrs.textEditor.insertAt(selectionRange[1] + leftDelim.length, rightDelim);\n    } else {\n      this.attrs.textEditor.replaceBeforeCursor(selectionRange[0], leftDelim + rightDelim);\n      this.attrs.textEditor.moveCursorTo(selectionRange[0] + leftDelim.length);\n    }\n  }\n}\n","/**\n * Copied & modified from:\n * https://github.com/flarum/mentions/blob/master/js/src/forum/fragments/PostQuoteButton.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 Stichting Flarum (Flarum Foundation)\n * Copyright (c) 2014-2019 Toby Zerner (toby.zerner@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport Fragment from 'flarum/Fragment';\nimport icon from 'flarum/common/helpers/icon';\n\nimport reply from '../utils/reply';\n\nexport default class PostQuoteButton extends Fragment {\n  constructor(post) {\n    super();\n\n    this.post = post;\n  }\n\n  view() {\n    return (\n      <button\n        class=\"Button PostQuoteButton\"\n        onclick={() => {\n          reply(this.post, this.content);\n        }}\n      >\n        {icon('fas fa-quote-left', { className: 'Button-icon' })}\n        {app.translator.trans('flarum-mentions.forum.post.quote_button')}\n      </button>\n    );\n  }\n\n  show(left, top) {\n    const $this = this.$().show();\n    const parentOffset = $this.offsetParent().offset();\n\n    $this.css('left', left - parentOffset.left).css('top', top - parentOffset.top);\n\n    this.hideHandler = this.hide.bind(this);\n    $(document).on('mouseup', this.hideHandler);\n  }\n\n  showStart(left, top) {\n    const $this = this.$();\n\n    this.show(left, $(window).scrollTop() + top - $this.outerHeight() - 5);\n  }\n\n  showEnd(right, bottom) {\n    const $this = this.$();\n\n    this.show(right - $this.outerWidth(), $(window).scrollTop() + bottom + 5);\n  }\n\n  hide() {\n    this.$().hide();\n    $(document).off('mouseup', this.hideHandler);\n  }\n}\n","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/common/app';\nimport CommentPost from 'flarum/components/CommentPost';\nimport addTextEditorButton from './addTextEditorButton';\nimport addPostQuoteButton from './addPostQuoteButton';\nimport addCopyListener from './addCopyListener';\n\napp.initializers.add('the-turk-mathren', () => {\n  let whenLoaded = {};\n  let hasLoaded = false;\n  let isLoading = false;\n\n  const load = () => {\n    isLoading = true;\n\n    $.getScript('//cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js', () => {\n      $.getScript('//cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js', () => {\n        for (const id in whenLoaded) {\n          whenLoaded[id]();\n        }\n\n        whenLoaded = {};\n        isLoading = false;\n        hasLoaded = true;\n      });\n    });\n  };\n\n  // Add Text Editor buttons\n  addTextEditorButton();\n\n  /**\n   * Show a Quote button when Post text is selected\n   *\n   * We have to run KaTeX's Copy-tex plugin on the selected post\n   * and need to modify `selectedText` function which comes with\n   * `flarum/mentions` extension.\n   **/\n  addPostQuoteButton();\n\n  // Hook into global copy handler to modify behavior on `.katex` elements\n  addCopyListener();\n\n  var renderMath = function (element, id) {\n    const render = () => renderMathInElement(element, app.forum.attribute('mathRenKatexOptions'));\n\n    if (!hasLoaded) {\n      whenLoaded[id] = render;\n\n      if (isLoading) return;\n\n      load();\n    } else {\n      render();\n    }\n  };\n\n  /* Run KaTeX renderer on every post loading */\n  extend(CommentPost.prototype, 'oncreate', function () {\n    renderMath($(this.element)[0], this.attrs.post.id());\n  });\n\n  /**\n   * Render the math in preview mode\n   * Note: We also have this TextFormatter's Live preview attributes\n   *\n   * @see https://github.com/s9e/TextFormatter/blob/master/docs/JavaScript/Live_preview_attributes.md\n   */\n  if (s9e && s9e.TextFormatter) {\n    extend(s9e.TextFormatter, 'preview', function (original, preview, element) {\n      if (element.matches('.Post *')) renderMath(element, 0);\n    });\n  }\n});\n","/**\n * Copied from:\n * https://github.com/flarum/mentions/blob/master/js/src/forum/utils/cleanDisplayName.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 Stichting Flarum (Flarum Foundation)\n * Copyright (c) 2014-2019 Toby Zerner (toby.zerner@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport default function cleanDisplayName(user) {\n  return user.displayName().replace(/\"#[a-z]{0,3}[0-9]+/, '_');\n}\n","/**\n * Define delimiters those will be used in Copy-tex plugin\n *\n * @see https://github.com/KaTeX/KaTeX/blob/master/contrib/copy-tex/katex2tex.js#L1-L5\n * @returns {object}\n */\n\nexport default function copyDelimiters(delimiters) {\n  return {\n    inline: [delimiters.inline.left, delimiters.inline.right],\n    display: [delimiters.block.left, delimiters.block.right],\n  };\n}\n","/**\n * Copied & modified from:\n * https://github.com/KaTeX/KaTeX/blob/master/contrib/copy-tex/katex2tex.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2013-2019 Khan Academy and other contributors\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n// Replace .katex elements with their TeX source (<annotation> element).\n// Modifies fragment in-place.  Useful for writing your own 'copy' handler,\n// as in copy-tex.js.\nexport const katexReplaceWithTex = function (fragment, copyDelimiters) {\n  // Remove .katex-html blocks that are preceded by .katex-mathml blocks\n  // (which will get replaced below).\n  const katexHtml = fragment.querySelectorAll('.katex-mathml + .katex-html');\n  for (let i = 0; i < katexHtml.length; i++) {\n    const element = katexHtml[i];\n    if (element.remove) {\n      element.remove(null);\n    } else {\n      element.parentNode.removeChild(element);\n    }\n  }\n  // Replace .katex-mathml elements with their annotation (TeX source)\n  // descendant, with inline delimiters.\n  const katexMathml = fragment.querySelectorAll('.katex-mathml');\n  for (let i = 0; i < katexMathml.length; i++) {\n    const element = katexMathml[i];\n    const texSource = element.querySelector('annotation');\n    if (texSource) {\n      if (element.replaceWith) {\n        element.replaceWith(texSource);\n      } else {\n        element.parentNode.replaceChild(texSource, element);\n      }\n      texSource.innerHTML = copyDelimiters.inline[0] + texSource.innerHTML + copyDelimiters.inline[1];\n    }\n  }\n  // Switch display math to display delimiters.\n  const displays = fragment.querySelectorAll('.katex-display annotation');\n  for (let i = 0; i < displays.length; i++) {\n    const element = displays[i];\n    element.innerHTML =\n      copyDelimiters.display[0] +\n      element.innerHTML.substr(\n        copyDelimiters.inline[0].length,\n        element.innerHTML.length - copyDelimiters.inline[0].length - copyDelimiters.inline[1].length\n      ) +\n      copyDelimiters.display[1];\n  }\n  return fragment;\n};\n\nexport default katexReplaceWithTex;\n","/**\n * Copied from:\n * https://github.com/flarum/mentions/blob/master/js/src/forum/utils/reply.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 Stichting Flarum (Flarum Foundation)\n * Copyright (c) 2014-2019 Toby Zerner (toby.zerner@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\nimport EditPostComposer from 'flarum/components/EditPostComposer';\nimport cleanDisplayName from './cleanDisplayName';\n\nfunction insertMention(post, composer, quote) {\n  const user = post.user();\n  const mention = `@\"${(user && cleanDisplayName(user)) || app.translator.trans('core.lib.username.deleted_text')}\"#p${post.id()} `;\n\n  // If the composer is empty, then assume we're starting a new reply.\n  // In which case we don't want the user to have to confirm if they\n  // close the composer straight away.\n  if (!composer.fields.content()) {\n    composer.body.attrs.originalContent = mention;\n  }\n\n  const cursorPosition = composer.editor.getSelectionRange()[0];\n  const preceding = composer.fields.content().slice(0, cursorPosition);\n  const precedingNewlines = preceding.length == 0 ? 0 : 3 - preceding.match(/(\\n{0,2})$/)[0].length;\n\n  composer.editor.insertAtCursor(\n    Array(precedingNewlines).join('\\n') + // Insert up to two newlines, depending on preceding whitespace\n      (quote ? '> ' + mention + quote.trim().replace(/\\n/g, '\\n> ') + '\\n\\n' : mention),\n    false\n  );\n}\n\nexport default function reply(post, quote) {\n  if (app.composer.bodyMatches(EditPostComposer) && app.composer.body.attrs.post.discussion() === post.discussion()) {\n    // If we're already editing a post in the discussion of post we're quoting,\n    // insert the mention directly.\n    insertMention(post, app.composer, quote);\n  } else {\n    // The default \"Reply\" action behavior will only open a new composer if\n    // necessary, but it will always be a ReplyComposer, hence the exceptional\n    // case above.\n    DiscussionControls.replyAction.call(post.discussion()).then((composer) => insertMention(post, composer, quote));\n  }\n}\n","/**\n * Copied & modified from:\n * https://github.com/flarum/mentions/blob/master/js/src/forum/utils/selectedText.js\n *\n * The MIT License (MIT)\n *\n * Copyright (c) 2019-2021 Stichting Flarum (Flarum Foundation)\n * Copyright (c) 2014-2019 Toby Zerner (toby.zerner@gmail.com)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport katexReplaceWithTex from './katex2tex';\n\nexport default function selectedText(body, copyDelimiters) {\n  const selection = window.getSelection();\n  if (selection.rangeCount) {\n    const range = selection.getRangeAt(0);\n    const parent = range.commonAncestorContainer;\n    if (body[0] === parent || $.contains(body[0], parent)) {\n      let fragment = selection.getRangeAt(0).cloneContents();\n\n      if (fragment.querySelector('.katex-mathml')) {\n        fragment = katexReplaceWithTex(fragment, copyDelimiters);\n      }\n\n      const clone = $('<div>').append(fragment);\n\n      // Replace emoji images with their shortcode (found in alt attribute)\n      clone.find('img.emoji').replaceWith(function () {\n        return this.alt;\n      });\n\n      // Replace all other images with a Markdown image\n      clone.find('img').replaceWith(function () {\n        return '![](' + this.src + ')';\n      });\n\n      // Replace all links with a Markdown link\n      clone.find('a').replaceWith(function () {\n        return '[' + this.innerText + '](' + this.href + ')';\n      });\n\n      return clone.text();\n    }\n  }\n  return '';\n}\n","module.exports = flarum.core.compat['Fragment'];","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/app'];","module.exports = flarum.core.compat['common/components/Button'];","module.exports = flarum.core.compat['common/components/Dropdown'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['common/helpers/icon'];","module.exports = flarum.core.compat['common/utils/ItemList'];","module.exports = flarum.core.compat['components/CommentPost'];","module.exports = flarum.core.compat['components/DiscussionPage'];","module.exports = flarum.core.compat['components/EditPostComposer'];","module.exports = flarum.core.compat['components/TextEditor'];","module.exports = flarum.core.compat['utils/DiscussionControls'];"],"sourceRoot":""}