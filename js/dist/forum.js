module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e){t.exports=flarum.core.compat.app},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e,n){"use strict";function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}n.d(e,"a",(function(){return o}))},,function(t,e){t.exports=flarum.core.compat.Component},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},,function(t,e){t.exports=flarum.core.compat["utils/extract"]},function(t,e){t.exports=flarum.core.compat["components/TextEditor"]},function(t,e){t.exports=flarum.core.compat["components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["helpers/icon"]},function(t,e){t.exports=flarum.core.compat["utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},,,,,,function(t,e,n){"use strict";n.r(e);var o=n(1),r=n(0),i=n.n(r),a=n(6),s=n.n(a),c=n(9),l=n.n(c),u=n(3),p=n(5),f=n.n(p),d=n(10),h=n.n(d),v=n(2),g=n.n(v),b=n(11),x=n.n(b),y=n(12),w=n.n(y),k=function(t){function e(){return t.apply(this,arguments)||this}Object(u.a)(e,t);var n=e.prototype;return n.init=function(){this.textEditor=this.props.textEditor,this.delimiters={inline:i.a.forum.attribute("mathRenMainInlineDelimiter"),block:i.a.forum.attribute("mathRenMainBlockDelimiter")}},n.view=function(){return h.a.component({className:"MathRenDropdown",buttonClassName:"Button Button--flat",label:w()("fas fa-square-root-alt"),children:this.items().toArray()})},n.items=function(){var t=this,e=new x.a;return e.add("mathBlock",g.a.component({icon:"fas fa-vector-square",children:i.a.translator.trans("the-turk-mathren.forum.textEditor.blockExpression"),onclick:function(){var e=t.delimiters.block.left,n=t.delimiters.block.right,o=t.wrapSelection(e,n);t.textEditor.setValue(o.value),t.textEditor.setSelectionRange(o.range.start,o.range.end)}}),50),e.add("mathInline",g.a.component({icon:"fas fa-grip-lines",children:i.a.translator.trans("the-turk-mathren.forum.textEditor.inlineExpression"),onclick:function(){var e=t.delimiters.inline.left,n=t.delimiters.inline.right,o=t.wrapSelection(e,n);t.textEditor.setValue(o.value),t.textEditor.setSelectionRange(o.range.start,o.range.end)}}),0),e},n.wrapSelection=function(t,e){var n=this.textEditor.getSelectionRange(),o=this.textEditor.value(),r=o.slice(0,n[0]),i=o.slice(n[1]),a=o.slice(n[0],n[1]);return{value:r+t+a+e+i,range:{start:r.length+t.length,end:r.length+t.length+a.length}}},e}(f.a);var S=n(8),E=n.n(S),R=n(13),j=n.n(R);function C(t,e,n){var o=t.user(),r="@"+(o?o.username():t.number())+"#"+t.id()+" ";e.content()||(e.props.originalContent=r);var i=e.editor.getSelectionRange()[0],a=e.editor.value().slice(0,i),s=0==a.length?0:3-a.match(/(\n{0,2})$/)[0].length;e.editor.insertAtCursor(Array(s).join("\n")+(n?"> "+r+n.trim().replace(/\n/g,"\n> ")+"\n\n":r))}var M=function(t){function e(){return t.apply(this,arguments)||this}Object(u.a)(e,t);var n=e.prototype;return n.view=function(){var e=this,n=E()(this.props,"post"),o=E()(this.props,"content");return this.props.className="Button PostQuoteButton",this.props.icon="fas fa-quote-left",this.props.children=app.translator.trans("flarum-mentions.forum.post.quote_button"),this.props.onclick=function(){e.hide(),function(t,e){var n=app.composer.component;n&&n.props.post&&n.props.post.discussion()===t.discussion()?C(t,n,e):j.a.replyAction.call(t.discussion()).then((function(n){return C(t,n,e)}))}(n,o)},this.props.onmousedown=function(t){return t.stopPropagation()},t.prototype.view.call(this)},n.config=function(t){t||$(document).on("mousedown",this.hide.bind(this))},n.show=function(t,e){var n=this.$().show(),o=n.offsetParent().offset();n.css("left",t-o.left).css("top",e-o.top)},n.showStart=function(t,e){var n=this.$();this.show(t,$(window).scrollTop()+e-n.outerHeight()-5)},n.showEnd=function(t,e){var n=this.$();this.show(t-n.outerWidth(),$(window).scrollTop()+e+5)},n.hide=function(){this.$().hide()},e}(g.a),T=function(t,e){for(var n=t.querySelectorAll(".katex-mathml + .katex-html"),o=0;o<n.length;o++){var r=n[o];r.remove?r.remove(null):r.parentNode.removeChild(r)}for(var i=t.querySelectorAll(".katex-mathml"),a=0;a<i.length;a++){var s=i[a],c=s.querySelector("annotation");c&&(s.replaceWith?s.replaceWith(c):s.parentNode.replaceChild(c,s),c.innerHTML=e.inline[0]+c.innerHTML+e.inline[1])}for(var l=t.querySelectorAll(".katex-display annotation"),u=0;u<l.length;u++){var p=l[u];p.innerHTML=e.display[0]+p.innerHTML.substr(e.inline[0].length,p.innerHTML.length-e.inline[0].length-e.inline[1].length)+e.display[1]}return t};function O(t){return{inline:[t.inline.left,t.inline.right],display:[t.block.left,t.block.right]}}function D(){Object(o.extend)(s.a.prototype,"config",(function(t,e){if(app.forum.attribute("mathRenAddQuoteButton")&&app.forum.attribute("mathRenEnableCopyTeX")){var n=this.props.post,o={inline:app.forum.attribute("mathRenMainInlineDelimiter"),block:app.forum.attribute("mathRenMainBlockDelimiter")};if(!(e||n.isHidden()||app.session.user&&!n.discussion().canReply())){var r=this.$(".Post-body"),i=$('<div class="Post-quoteButtonContainer-mathRen"></div>'),a=function(t){setTimeout((function(){var e=function(t,e){var n=window.getSelection();if(n.rangeCount){var o=n.getRangeAt(0).commonAncestorContainer;if(t[0]===o||$.contains(t[0],o)){var r=n.getRangeAt(0).cloneContents();r.querySelector(".katex-mathml")&&(r=T(r,e));var i=$("<div>").append(r);return i.find("img.emoji").replaceWith((function(){return this.alt})),i.find("img").replaceWith((function(){return"![]("+this.src+")"})),i.find("a").replaceWith((function(){return"["+this.innerText+"]("+this.href+")"})),i.text()}}return""}(r,O(o));if(e){var a=new M({post:n,content:e});m.render(i[0],a.render());var s=window.getSelection().getRangeAt(0).getClientRects(),c=s[0];if(t.clientY<c.bottom&&t.clientX-c.right<c.left-t.clientX)a.showStart(c.left,c.top);else{var l=s[s.length-1];a.showEnd(l.right,l.bottom)}}}),1)};this.$().after(i).on("mouseup",a),"ontouchstart"in window&&document.addEventListener("selectionchange",a,!1)}}}))}var P=n(14),A=n.n(P);i.a.initializers.add("the-turk-mathren",(function(){var t={},e=!1,n=!1;Object(o.extend)(l.a.prototype,"toolbarItems",(function(t){if(!0===app.forum.attribute("mathRenEnableTextEditorButtons")){var e=new k({textEditor:this});t.add("the-turk-mathren",e)}})),D(),Object(o.extend)(A.a.prototype,"config",(function(t,e){if(!e&&app.forum.attribute("mathRenEnableCopyTeX")){var n={inline:app.forum.attribute("mathRenMainInlineDelimiter"),block:app.forum.attribute("mathRenMainBlockDelimiter")};document.addEventListener("copy",(function(t){var e=window.getSelection();if(!e.isCollapsed){var o=e.getRangeAt(0).cloneContents();if(o.querySelector(".katex-mathml")){for(var r=[],i=0;i<o.childNodes.length;i++)r.push(o.childNodes[i].outerHTML);t.clipboardData.setData("text/html",r.join("")),t.clipboardData.setData("text/plain",T(o,O(n)).textContent),t.preventDefault()}}}))}}));var r=function(o,r){var a=function(){return renderMathInElement(o,i.a.forum.attribute("mathRenKatexOptions"))};if(e)a();else{if(t[r]=a,n)return;n=!0,$.getScript("//cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js",(function(){$.getScript("//cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js",(function(){for(var o in t)t[o]();t={},n=!1,e=!0}))}))}};Object(o.extend)(s.a.prototype,"config",(function(t,e){e&&r($(".Post-body",this.element)[0],this.props.post.id())})),s9e&&s9e.TextFormatter&&Object(o.extend)(s9e.TextFormatter,"preview",(function(t,e,n){n.matches(".Post *")&&r(n,0)}))}))}]);
//# sourceMappingURL=forum.js.map