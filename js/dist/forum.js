module.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=20)}([function(t,e){t.exports=flarum.core.compat["common/app"]},function(t,e){t.exports=flarum.core.compat["common/extend"]},function(t,e,n){"use strict";function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}n.d(e,"a",(function(){return r}))},,function(t,e){t.exports=flarum.core.compat["common/components/Button"]},function(t,e){t.exports=flarum.core.compat["components/CommentPost"]},function(t,e){t.exports=flarum.core.compat["common/helpers/icon"]},,function(t,e){t.exports=flarum.core.compat["components/TextEditor"]},function(t,e){t.exports=flarum.core.compat["common/Component"]},function(t,e){t.exports=flarum.core.compat["common/components/Dropdown"]},function(t,e){t.exports=flarum.core.compat["common/utils/ItemList"]},function(t,e){t.exports=flarum.core.compat.Fragment},function(t,e){t.exports=flarum.core.compat["utils/DiscussionControls"]},function(t,e){t.exports=flarum.core.compat["components/EditPostComposer"]},function(t,e){t.exports=flarum.core.compat["components/DiscussionPage"]},,,,,function(t,e,n){"use strict";n.r(e);var o=n(1),r=n(0),i=n.n(r),a=n(5),c=n.n(a),s=n(8),u=n.n(s),l=n(2),p=n(9),f=n.n(p),d=n(10),h=n.n(d),v=n(4),b=n.n(v),x=n(11),g=n.n(x),y=n(6),w=n.n(y),k=function(t){function e(){return t.apply(this,arguments)||this}Object(l.a)(e,t);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.delimiters={inline:i.a.forum.attribute("mathRenMainInlineDelimiter"),block:i.a.forum.attribute("mathRenMainBlockDelimiter")}},n.oncreate=function(e){t.prototype.oncreate.call(this,e)},n.view=function(){return h.a.component({className:"MathRenDropdown",buttonClassName:"Button Button--flat",label:w()("fas fa-square-root-alt")},this.items().toArray())},n.items=function(){var t=this,e=new g.a;return e.add("mathBlock",b.a.component({icon:"fas fa-vector-square",onclick:function(){var e=t.delimiters.block.left,n=t.delimiters.block.right;t.wrapSelection(e,n)}},i.a.translator.trans("the-turk-mathren.forum.textEditor.blockExpression")),50),e.add("mathInline",b.a.component({icon:"fas fa-grip-lines",onclick:function(){var e=t.delimiters.inline.left,n=t.delimiters.inline.right;t.wrapSelection(e,n)}},i.a.translator.trans("the-turk-mathren.forum.textEditor.inlineExpression")),0),e},n.wrapSelection=function(t,e){var n=this.attrs.textEditor.getSelectionRange();n[0]!=n[1]?(this.attrs.textEditor.insertAt(n[0],t),this.attrs.textEditor.insertAt(n[1]+t.length,e)):(this.attrs.textEditor.replaceBeforeCursor(n[0],t+e),this.attrs.textEditor.moveCursorTo(n[0]+t.length))},e}(f.a);var j=n(12),S=n.n(j),C=n(13),E=n.n(C),R=n(14),M=n.n(R);function T(t,e,n){var o=t.user(),r='@"'+(o&&function(t){return t.displayName().replace(/"#[a-z]{0,3}[0-9]+/,"_")}(o)||app.translator.trans("core.lib.username.deleted_text"))+'"#p'+t.id()+" ";e.fields.content()||(e.body.attrs.originalContent=r);var i=e.editor.getSelectionRange()[0],a=e.fields.content().slice(0,i),c=0==a.length?0:3-a.match(/(\n{0,2})$/)[0].length;e.editor.insertAtCursor(Array(c).join("\n")+(n?"> "+r+n.trim().replace(/\n/g,"\n> ")+"\n\n":r),!1)}var O=function(t){function e(e){var n;return(n=t.call(this)||this).post=e,n}Object(l.a)(e,t);var n=e.prototype;return n.view=function(){var t=this;return m("button",{class:"Button PostQuoteButton",onclick:function(){var e,n;e=t.post,n=t.content,app.composer.bodyMatches(M.a)&&app.composer.body.attrs.post.discussion()===e.discussion()?T(e,app.composer,n):E.a.replyAction.call(e.discussion()).then((function(t){return T(e,t,n)}))}},w()("fas fa-quote-left",{className:"Button-icon"}),app.translator.trans("flarum-mentions.forum.post.quote_button"))},n.show=function(t,e){var n=this.$().show(),o=n.offsetParent().offset();n.css("left",t-o.left).css("top",e-o.top),this.hideHandler=this.hide.bind(this),$(document).on("mouseup",this.hideHandler)},n.showStart=function(t,e){var n=this.$();this.show(t,$(window).scrollTop()+e-n.outerHeight()-5)},n.showEnd=function(t,e){var n=this.$();this.show(t-n.outerWidth(),$(window).scrollTop()+e+5)},n.hide=function(){this.$().hide(),$(document).off("mouseup",this.hideHandler)},e}(S.a),A=function(t,e){for(var n=t.querySelectorAll(".katex-mathml + .katex-html"),o=0;o<n.length;o++){var r=n[o];r.remove?r.remove(null):r.parentNode.removeChild(r)}for(var i=t.querySelectorAll(".katex-mathml"),a=0;a<i.length;a++){var c=i[a],s=c.querySelector("annotation");s&&(c.replaceWith?c.replaceWith(s):c.parentNode.replaceChild(s,c),s.innerHTML=e.inline[0]+s.innerHTML+e.inline[1])}for(var u=t.querySelectorAll(".katex-display annotation"),l=0;l<u.length;l++){var p=u[l];p.innerHTML=e.display[0]+p.innerHTML.substr(e.inline[0].length,p.innerHTML.length-e.inline[0].length-e.inline[1].length)+e.display[1]}return t};function D(t){return{inline:[t.inline.left,t.inline.right],display:[t.block.left,t.block.right]}}function P(){Object(o.extend)(c.a.prototype,"oncreate",(function(){if(app.forum.attribute("mathRenAddQuoteButton")&&app.forum.attribute("mathRenEnableCopyTeX")){var t=this.attrs.post,e={inline:app.forum.attribute("mathRenMainInlineDelimiter"),block:app.forum.attribute("mathRenMainBlockDelimiter")};if(!(t.isHidden()||app.session.user&&!t.discussion().canReply())){var n=this.$(".Post-body"),o=$('<div class="Post-quoteButtonContainer-mathRen"></div>'),r=new O(t),i=function(t){setTimeout((function(){var i=function(t,e){var n=window.getSelection();if(n.rangeCount){var o=n.getRangeAt(0).commonAncestorContainer;if(t[0]===o||$.contains(t[0],o)){var r=n.getRangeAt(0).cloneContents();r.querySelector(".katex-mathml")&&(r=A(r,e));var i=$("<div>").append(r);return i.find("img.emoji").replaceWith((function(){return this.alt})),i.find("img").replaceWith((function(){return"![]("+this.src+")"})),i.find("a").replaceWith((function(){return"["+this.innerText+"]("+this.href+")"})),i.text()}}return""}(n,D(e));if(i){r.content=i,m.render(o[0],r.render());var a=window.getSelection().getRangeAt(0).getClientRects(),c=a[0];if(t.clientY<c.bottom&&t.clientX-c.right<c.left-t.clientX)r.showStart(c.left,c.top);else{var s=a[a.length-1];r.showEnd(s.right,s.bottom)}}}),1)};this.$().after(o).on("mouseup",i),"ontouchstart"in window&&document.addEventListener("selectionchange",i,!1)}}}))}var B=n(15),_=n.n(B);i.a.initializers.add("the-turk-mathren",(function(){var t={},e=!1,n=!1;Object(o.extend)(u.a.prototype,"toolbarItems",(function(t){!0===app.forum.attribute("mathRenEnableTextEditorButtons")&&t.add("the-turk-mathren",m(k,{textEditor:this.attrs.composer.editor}))})),P(),Object(o.extend)(_.a.prototype,"oncreate",(function(){if(app.forum.attribute("mathRenEnableCopyTeX")){var t={inline:app.forum.attribute("mathRenMainInlineDelimiter"),block:app.forum.attribute("mathRenMainBlockDelimiter")};document.addEventListener("copy",(function(e){var n=window.getSelection();if(!n.isCollapsed){var o=n.getRangeAt(0).cloneContents();if(o.querySelector(".katex-mathml")){for(var r=[],i=0;i<o.childNodes.length;i++)r.push(o.childNodes[i].outerHTML);e.clipboardData.setData("text/html",r.join("")),e.clipboardData.setData("text/plain",A(o,D(t)).textContent),e.preventDefault()}}}))}}));var r=function(o,r){var a=function(){return renderMathInElement(o,i.a.forum.attribute("mathRenKatexOptions"))};if(e)a();else{if(t[r]=a,n)return;n=!0,$.getScript("//cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js",(function(){$.getScript("//cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js",(function(){for(var o in t)t[o]();t={},n=!1,e=!0}))}))}};Object(o.extend)(c.a.prototype,"onupdate",(function(){var t=this.attrs.post.id();$.each($(".Post-body",this.element),(function(e,n){r(n,t+"_"+e)}))})),s9e&&s9e.TextFormatter&&Object(o.extend)(s9e.TextFormatter,"preview",(function(t,e,n){n.matches(".Post *")&&r(n,0)}))}))}]);
//# sourceMappingURL=forum.js.map